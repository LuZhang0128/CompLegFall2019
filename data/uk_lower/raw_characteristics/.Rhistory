mutate(constituency_name = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
##################################
# make the dataframe that we want
##################################
df <- committees %>%
mutate(full_name = DisplayAs) %>%
mutate(last_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\1")) %>%
mutate(first_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\3")) %>%
mutate(constituency_name = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
View(df)
head(constituencie$Constituencies)
head(constituencies$Constituencies)
View(parliamentaryPosts)
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "FlaseFLaseFlase")) %>%
unnest(committees)
View(df_a)
lapply(c("stringr", "dplyr", "plyr", "tidyverse", "rvest", "zoo", "XML", " tidyr "), pkgTest)
############################
# detach and load packages
############################
# remove objects
rm(list=ls())
# detach all libraries
detachAllPackages <- function() {
basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]
package.list <- setdiff(package.list,basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)
}
detachAllPackages()
# load libraries
pkgTest <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
lapply(c("stringr", "dplyr", "plyr", "tidyverse", "rvest", "zoo", "XML", " tidyr"), pkgTest)
lapply(c("stringr", "dplyr", "plyr", "tidyverse", "rvest", "zoo", "XML", "tidyr"), pkgTest)
# to dataframe
committees <- xmlToDataFrame(files[1])
############################
# detach and load packages
############################
# remove objects
rm(list=ls())
# detach all libraries
detachAllPackages <- function() {
basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]
package.list <- setdiff(package.list,basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)
}
detachAllPackages()
# load libraries
pkgTest <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
lapply(c("stringr", "dplyr", "plyr", "tidyverse", "rvest", "zoo", "XML", "tidyr"), pkgTest)
##########################
# set working directory
# import dataset
# create raw dataset
##########################
# set working directory
setwd('~/Documents/GitHub/CompLegFall2019/data/uk_lower/raw_characteristics/')
# read in dataset
files <- list.files(pattern="*.xml", full.names=TRUE, recursive=FALSE)
# to dataframe
committees <- xmlToDataFrame(files[1])
constituencies <- xmlToDataFrame(files[2])
experiences <- xmlToDataFrame(files[3])
governmentPosts <- xmlToDataFrame(files[4])
interests <- xmlToDataFrame(files[5])
oppositionPosts <- xmlToDataFrame(files[6])
parliamentaryPosts <- xmlToDataFrame(files[7])
parties <- xmlToDataFrame(files[8])
staff <- xmlToDataFrame(files[9])
##################################
# make the dataframe that we want
##################################
df <- committees %>%
mutate(full_name = DisplayAs) %>%
mutate(last_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\1")) %>%
mutate(first_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\3")) %>%
mutate(constituency_name = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "FlaseFLaseFlase")) %>%
unnest(committees)
View(df_a)
df %>%
mutate(committees = strsplit(as.character(Committees), "FlaseFLaseFlase"))
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "FalseFalseFalse")) %>%
unnest(committees)
View(df_a)
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "\\d{4}-\\d{2}-\\d{2}")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00"|"FalseFalseFalse")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00", "FalseFalseFalse")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00 ")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = strsplit(as.character(Committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = gsub("FalseFalseFalse", "", Committees))
View(df_a)
df_a <- df %>%
mutate(committees = gsub("FalseFalseFalse", "", Committees)) %>%
mutate(committees = strsplit(as.character(Committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = gsub("FalseFalseFalse", "", Committees)) %>%
mutate(committees = strsplit(as.character(committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees)
##################################
# make the dataframe that we want
##################################
df <- committees %>%
mutate(full_name = DisplayAs) %>%
mutate(last_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\1")) %>%
mutate(first_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\3")) %>%
mutate(constituency_namve = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
df_a <- df %>%
mutate(committees = gsub("False", "", Committees)) %>%
mutate(committees = gsub(" ", "", committees)) %>%
mutate(committees = gsub("True", "", committees)) %>%
mutate(committees = strsplit(as.character(committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees)
View(df_a)
df_a <- df %>%
mutate(committees = gsub("False", "", Committees)) %>%
mutate(committees = gsub("True", "", committees)) %>%
mutate(committees = strsplit(as.character(committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees)
df_a <- df %>%
mutate(committees = gsub("False", "", Committees)) %>%
mutate(committees = gsub("True", "", committees)) %>%
mutate(committees = strsplit(as.character(committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees) %>%
distinct()
is_empty(df$Committees)
?isset()
x=0
x=x+1;
x=0
for (i in 1:length(df)) {
if (is_empty(df$Committees[i])){
x=x+1;
}
}
df$a <- df$Committees
View(df)
if (is_null(df$Committees[i])){
x=x+1;
}
df$Committees[4]
df$Committees[5]
if (df$Committees[i] == " "){
x=x+1;
}
df$Committees[5]==" "
df$Committees[5]==""
if (df$Committees[i] == ""){
x=x+1;
}
df$Committees[df$Committees==""] <- "Temp"
df$Committees[5]
##################################
# make the dataframe that we want
##################################
df <- committees %>%
mutate(full_name = DisplayAs) %>%
mutate(last_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\1")) %>%
mutate(first_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\3")) %>%
mutate(constituency_namve = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
df$Committees[5]
df$Committees[5]==""
df$Committees[df$Committees==""] <- "Temp"
df$committees <- df$Committees
df$committees[df$committees==""] <- "Temp"
df$committees <- as.character(df$Committees)
df$committees[df$committees==""] <- "Temp"
df$committees[df$committees==""] <- "Temp"
View(df)
df$committees <- as.character(df$Committees)
df$committees[is.na(df$committees)] <- "Temp"
View(df)
df$committees <- as.character(df$Committees)
df$committees[is.na(df$committees)] <- "Temp"
df <- committees %>%
mutate(full_name = DisplayAs) %>%
mutate(last_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\1")) %>%
mutate(first_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\3")) %>%
mutate(constituency_namve = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
df_a <- df %>%
mutate(committees = gsub("False", "", committees)) %>%
mutate(committees = gsub("True", "", committees)) %>%
mutate(committees = strsplit(as.character(committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees) %>%
distinct()
View(df_a)
##################################
# make the dataframe that we want
##################################
df <- committees
df$committees <- as.character(df$Committees)
df$committees[is.na(df$committees)] <- "Temp"
df$committees <- as.factor(df$committees)
##################################
# make the dataframe that we want
##################################
df <- committees
df$committees <- as.character(df$Committees)
df$committees[is.na(df$committees)] <- "Temp"
df$committees <- as.factor(df$committees)
View(df)
df_a <- df %>%
mutate(full_name = DisplayAs) %>%
mutate(last_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\1")) %>%
mutate(first_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\3")) %>%
mutate(constituency_namve = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
df_b <- df_a %>%
mutate(committees = gsub("False", "", committees)) %>%
mutate(committees = gsub("True", "", committees)) %>%
mutate(committees = strsplit(as.character(committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees) %>%
distinct()
View(df_b)
df$committees <- as.character(df$Committees)
df$committees[is.na(df$committees)] <- "Temp"
##################################
# make the dataframe that we want
##################################
df <- committees
df$Committees <- as.character(df$Committees)
df$Committees[is.na(df$Committees)] <- "Temp"
View(df)
df$Committees <- as.character(df$Committees)
df$Committees[is.na(df$Committees)] <- "Temp"
View(df)
df$Committees <- as.character(df$Committees)
View(df)
df$committees[df$committees==""] <- "Temp"
df$committees <- df$Committees
df$committees[df$committees==""] <- "Temp"
##################################
# make the dataframe that we want
##################################
df <- committees
df$committees <- df$Committees
df$committees[df$committees==""] <- "Temp"
##################################
# make the dataframe that we want
##################################
df <- committees
df$committees <- as.character(df$Committees)
df$committees[df$committees==""] <- "Temp"
##################################
# make the dataframe that we want
##################################
df <- committees
df$committees <- as.character(df$Committees)
df$committees[df$committees==""] <- "Temp"
df_a <- df %>%
mutate(full_name = DisplayAs) %>%
mutate(last_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\1")) %>%
mutate(first_name = str_replace(ListAs,"(.*)(,\\s)(.*)","\\3")) %>%
mutate(constituency_namve = MemberFrom) %>%
mutate(start_date = str_extract(HouseStartDate,"\\d{4}-\\d{2}-\\d{2}")) %>%
mutate(end_date = str_extract(HouseEndDate,"\\d{4}-\\d{2}-\\d{2}"))
df_b <- df_a %>%
mutate(committees = gsub("False", "", committees)) %>%
mutate(committees = gsub("True", "", committees)) %>%
mutate(committees = strsplit(as.character(committees), "\\d{4}-\\d{2}-\\d{2}T00:00:00")) %>%
unnest(committees) %>%
distinct()
df_b$committees[df_b$committees==""] <- NA
na.omit(df_b$committees)
df_c <- df_b[!is.na(df_b$committees)]
df_c <- subset(df_b, !is.na(committees))
View(df_c)
df_c$committees[df_c$committees=="Temp"]<- NA
View(governmentPosts)
View(governmentPosts)
View(oppositionPosts)
View(parliamentaryPosts)
View(constituencies)
View(parties)
View(parties)
View(oppositionPosts)
View(oppositionPosts)
View(interests)
View(experiences)
View(governmentPosts)
View(oppositionPosts)
View(parliamentaryPosts)
View(staff)
View(df_c)
########################
# create committee.csv
########################
committee_name <- df_c$committees %>%
distinct()
########################
# create committee.csv
########################
committee_name <- df_c$committees %>%
unique()
View(committee_name)
########################
# create committee.csv
########################
df_c$committees %>%
mutate(committee_name = strsplit(df_c$committees, "("))
########################
# create committee.csv
########################
strsplit(df_c$committees, "(")
########################
# create committee.csv
########################
strsplit(df_c$committees, [(])
########################
# create committee.csv
########################
strsplit(df_c$committees, [(] )
########################
# create committee.csv
########################
strsplit(df_c$committees, "(" )
########################
# create committee.csv
########################
strsplit(df_c$committees, "()" )
########################
# create committee.csv
########################
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(committee_name)
View(df_aa)
df_aa$type <- strsplit(df_c$committees, '[()]' )
df_aa$type <- strsplit(committee_name, '[()]')
df_aa$type <- strsplit(committee_name, '[()]')[2]
View(df_aa)
df_aa$type <- strsplit(committee_name, '[()]')[,2]
df_aa$type <- strsplit(committee_name, '[()]') %>%
unnest()
df_aa$type <- strsplit(committee_name, '[()]')[[2]]
View(df_aa)
df_aa$type <- strsplit(committee_name, '[()]')[[1]]
View(df_aa)
df_aa$type <- strsplit(committee_name, '[()]')
View(df_aa)
do.call(rbind, df_aa$type )
committee_name <- df_c$committees %>%
unique()
type <- strsplit(committee_name, '[()]')
df_aa <- do.call(rbind, type)
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(committee_name)
df_aa$type <- strsplit(committee_name, '[()]',2)
View(df_aa)
df_aa$type <- strsplit(committee_name, '[()]',1)
View(df_aa)
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(committee_name)
View(df_aa)
df_aa$type <- strsplit(committee_name, '[()]')
View(df_aa)
df_bb <- do.call(rbind, str_split(committee_name, '[()]'))
df_ab <- df_aa %>%
sepearte(type, c("name","type"))
df_ab <- df_aa %>%
seperate(type, c("name","type"))
df_ab <- df_aa %>%
separate(type, c("name","type"))
View(df_ab)
str_split_fixed(committee_name, '[()]', 2)
df_aa$type <- str_split_fixed(committee_name, '[()]', 2)
df_aa <- as.data.frame(committee_name)
df_aa$type <- str_split_fixed(committee_name, '[()]', 2)
View(df_aa)
df_aa$type <- str_split_fixed(committee_name, '[()]', 2)[,2]
df_aa$type <- str_split_fixed(committee_name, '[()]')[,2]
df_aa$type <- str_split_fixed(committee_name, '[()]',2)[,2]
df_ab <- df_aa %>%
gsub(")", "", type)
df_ab <- df_aa %>%
gsub('[]', "", type)
df_ab <- df_aa %>%
gsub('[)]', "", type)
df_ab <- df_aa %>%
gsub('[())]', "", type)
df_ab <- df_aa %>%
gsub('[()]', "", type)
df_ab <- df_aa %>%
gsub("log\\)", "", type)
View(df_ab)
df_ab <- df_aa %>%
mutate(type = gsub("log\\)", "", df_aa$type))
df_ab <- df_aa %>%
mutate(type = gsub("\\)", "", df_aa$type))
########################
# create committee.csv
########################
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(committee_name)
df_aa$type <- str_split_fixed(committee_name, "\\(",2)[,2]
df_ab <- df_aa %>%
mutate(type = gsub("\\)", "", df_aa$type))
df_aa <- df_aa %>%
mutate(committee_name = str_split_fixed(committee_name, "\\(",2)[,1]) %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2])
View(df_aa)
########################
# create committee.csv
########################
name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(name)
df_aa <- df_aa %>%
mutate(committee_name = str_split_fixed(committee_name, "\\(",2)[,1]) %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2])
########################
# create committee.csv
########################
name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(name)
df_aa <- df_aa %>%
mutate(committee_name = str_split_fixed(name, "\\(",2)[,1]) %>%
mutate(type = str_split_fixed(name, "\\(",2)[,2])
df_aa <- df_aa %>%
mutate(committee_name = str_split_fixed(name, "\\(",2)[,1]) %>%
mutate(type = gsub("\\)", "", df_aa$type))
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(name)
df_aa <- df_aa %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2]) %>%
mutate(committee_name = str_split_fixed(committee_name, "\\(",2)[,1]) %>%
mutate(type = gsub("\\)", "", df_aa$type))
()
()
########################
# create committee.csv
########################
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(committee_name)
df_aa <- df_aa %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2]) %>%
mutate(committee_name = str_split_fixed(committee_name, "\\(",2)[,1]) %>%
mutate(type = gsub("\\)", "", df_aa$type))
df_aa <- as.data.frame(committee_name)
View(df_aa)
df_aa <- df_aa %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2])
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(committee_name)
df_aa <- df_aa %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2]) %>%
mutate(committee_name = str_split_fixed(committee_name, "\\(",2)[,1])
df_aa <- as.data.frame(committee_name)
df_aa <- df_aa %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2]) %>%
mutate(committee_name = str_split_fixed(committee_name, "\\(",2)[,1]) %>%
mutate(type = gsub("\\)", "", type))
committee_name <- df_c$committees %>%
unique()
df_aa <- as.data.frame(committee_name)
df_aa <- df_aa %>%
mutate(type = str_split_fixed(committee_name, "\\(",2)[,2]) %>%
mutate(committee_name = str_split_fixed(committee_name, "\\(",2)[,1]) %>%
mutate(type = gsub("\\)", "", type))
df_aa$type[df_aa$type=="C"] <- "Common"
df_aa$type[df_aa$type=="L"] <- "Lord"
df_aa$type[df_aa$type=="Joint"] <- "Joint Committee"

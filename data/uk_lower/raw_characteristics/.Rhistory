# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name) )
# Use a line graph to display the evolution through time of the proportion of all given names that correspond to one of these four names (one line per name).
top_names <- babynames %>%
group_by(year) %>%
filter(name %in% c("Emma","Olivia","Liam","Noah"))
qplot(year, prop, data = top_clean_names, geom = 'line', color = name)
# The sudden drops in the previous graph come from the fact that it depicts two observations for each year. For each name, the graph represents the number of females and males who were given the name. (Each name is predominantly given to people of a given sex. Unusual name assignments may be part intential, and part results of errors in recording people’s sexes)
top_clean_names <- top_names %>%
filter(prop > 0.0002)
qplot(year, prop, data = top_clean_names, geom = 'line', color = name)
canada_commons_members_parl42 <- read.csv("~/Documents/GitHub/CompLegFall2019/data/canadaTextParsing/Members (CSV)/canada_commons_members_parl42.csv", comment.char="#")
View(canada_commons_members_parl42)
library(babynames)
library(tidyverse)
library(gapminder)
# For the year 2017, find the most common name among females.
babynames %>%
filter(year == 2017) %>%
filter(sex == "F" ) %>%
arrange(desc(n))
# For the year 1982, find the number of males.
babynames %>%
filter(year == 1982) %>%
count(sex == "M")
# For each year, find the number of distinct male and female names given in that year.
babynames %>%
group_by(year) %>%
distinct(name) %>%
count()
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name) )
# Use a line graph to display the evolution through time of the proportion of all given names that correspond to one of these four names (one line per name).
top_names <- babynames %>%
group_by(year) %>%
filter(name %in% top_names_2017)
qplot(year, prop, data = top_names, geom = 'line', color = name)
# The sudden drops in the previous graph come from the fact that it depicts two observations for each year. For each name, the graph represents the number of females and males who were given the name. (Each name is predominantly given to people of a given sex. Unusual name assignments may be part intential, and part results of errors in recording people’s sexes)
top_clean_names <- top_names %>%
filter(prop > 0.0002)
qplot(year, prop, data = top_clean_names, geom = 'line', color = name)
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- babynames %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name)
View(top_names_2017)
# Use a line graph to display the evolution through time of the proportion of all given names that correspond to one of these four names (one line per name).
top_names <- babynames %>%
group_by(year) %>%
filter(name %in% top_names_2017)
qplot(year, prop, data = top_names, geom = 'line', color = name)
library(babynames)
library(tidyverse)
library(gapminder)
# For the year 2017, find the most common name among females.
babynames %>%
filter(year == 2017) %>%
filter(sex == "F" ) %>%
arrange(desc(n))
# For the year 1982, find the number of males.
babynames %>%
filter(year == 1982) %>%
count(sex == "M")
# For each year, find the number of distinct male and female names given in that year.
babynames %>%
group_by(year) %>%
distinct(name) %>%
count()
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name) )
# Use a line graph to display the evolution through time of the proportion of all given names that correspond to one of these four names (one line per name).
top_names <- babynames %>%
group_by(year) %>%
filter(name %in% c("Emma","Olivia","Liam","Noah"))
qplot(year, prop, data = top_names, geom = 'line', color = name)
# The sudden drops in the previous graph come from the fact that it depicts two observations for each year. For each name, the graph represents the number of females and males who were given the name. (Each name is predominantly given to people of a given sex. Unusual name assignments may be part intential, and part results of errors in recording people’s sexes)
top_clean_names <- top_names %>%
filter(prop > 0.0002)
qplot(year, prop, data = top_clean_names, geom = 'line', color = name)
babynames
library(babynames)
library(tidyverse)
library(gapminder)
View(babynames)
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
group_by(sex);
filter(year == 2017) %>%
top_n(4, n) %>%
select(name) )
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
group_by(sex) %>%
filter(year == 2017 | sex) %>%
top_n(4, n) %>%
select(name) )
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
group_by(sex) %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name|sex) )
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
group_by(sex) %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name & sex) )
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
group_by(sex) %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name) )
# Find the four most given names in 2017 (across both sexes). Store these four names into a character vector and call that vector top_names_2017
top_names_2017 <- as.character(babynames %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name, sex) )
babynames %>%
filter(year == 2017) %>%
top_n(4, n) %>%
select(name, sex)
# vote type
votes$type <- "Missing"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "^2nd reading")] <- "Bill: second reading"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "^3rd reading")] <- "Bill: third reading"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "^Concurrence at report stage")] <- "Bill: concurrence at report stage"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "\\(report stage (sub)?amendment")] <- "Bill: amendment at report stage"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "^Time allocation for Bill")] <- "Bill: time allocation"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "^Motion respecting Senate amendments to Bill")] <- "Bill: motion respecting Senate amendments"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "\\(referral (to a committee|of subject)")] <- "Bill: referral to a committee"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "\\(recommittal to a committee")] <- "Bill: recommittal to a committee"
votes$type[votes$bill_number != "None" & str_detect(votes$description, "\\(hoist amendment")] <- "Bill: hoist amendment"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Opposition Motion")] <- "Motion (opposition)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Government Business")] <- "Government business"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Private Members' Business")] <- "Motion (private members' business)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Appointment of an officer")] <- "Other (appointment of an officer)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "Report of the (Standing|Special)")] <- "Other (report)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Budgetary policy")] <- "Other (budgetary policy)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion to adjourn the debate")] <- "Motion (to adjourn the debate)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion for closure")] <- "Motion (for closure)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion to adjourn the House")] <- "Motion (to adjourn the House)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion to hear another Member")] <- "Motion (to hear another member)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion to proceed to Orders of the Day")] <- "Motion (to proceed to Orders of the Day)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion to restore a vote in estimates")] <- "Motion (to restore a vote in estimates)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion for the production of papers")] <- "Motion (for the production of papers)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Motion respecting the proceedings and business of the House")] <- "Motion (respecting the proceedings and business of the House)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Ways and Means motion")] <- "Motion (Ways and Means)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Referral of a question of privilege to committee")] <- "Other (referral of a question of privilage to a committee)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Address in Reply to the Speech from the Throne")] <- "Other (address in reply to the Speech from the Throne)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Concurrence in an opposed item")] <- "Concurrence (in an opposed item)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Concurrence in estimates")] <- "Concurrence (in estimates)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Concurrence in Interim Supply")] <- "Concurrence (in interim supply)"
votes$type[votes$bill_number == "None" & str_detect(votes$description, "^Concurrence in the Report")] <- "Concurrence (in a report)"
gssexam <- read.csv("~/Desktop/gssexam.csv")
View(gssexam)
#######################
# set working directory
# load data
# and load libraries
#######################
# remove objects
rm(list=ls())
# detach all libraries
detachAllPackages <- function() {
basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]
package.list <- setdiff(package.list,basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)
}
detachAllPackages()
# load libraries
pkgTest <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
lapply(c("stringr", "dplyr", "plyr", "tidyverse", "rvest", "zoo"), pkgTest)
gssexam %>%
group_by(relig) %>%
max(count(relig))
##################
#b) Recode the variable *relig* to a new dichotomous variable *religion* with two categories:
#the one is the category with the most frequency named as itself,
#the other one is the rest of categories named "Others".
##################
gssexam <- read.csv("~/Desktop/gssexam.csv")
gssexam %>%
group_by(relig) %>%
max(count(relig))
gssexam %>%
group_by(relig) %>%
max(count())
gssexam %>%
group_by(relig)
gssexam %>%
group_by(relig) %>%
count()
gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
gssexam %>%
select(relig) %>%
group_by(relig) %>%
max(count())
gssexam %>%
select(relig) %>%
group_by(relig) %>%
count() %>%
max()
freq <- gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
max(freq)
View(freq)
max(freq$freq)
gssexam <- read.csv("~/Desktop/gssexam.csv")
f <- gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
max(f$freq)
f$relig[which.max(f$freq)]
?mutate
gssexam$religion <- c("Protestant","Others")
level(gssexam$religion) <- c("Protestant","Others")
levels(gssexam$religion) <- c("Protestant","Others")
gssexam$religion <- "initial"
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam <- read.csv("~/Desktop/gssexam.csv")
f <- gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
f$relig[which.max(f$freq)]
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[gssexam$relig != "Protestant"] <- "Others"
gssexam <- read.csv("~/Desktop/gssexam.csv")
f <- gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
f$relig[which.max(f$freq)]
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[gssexam$relig != "Protestant"] <- "Others"
gssexam <- read.csv("~/Desktop/gssexam.csv")
f <- gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
f$relig[which.max(f$freq)]
gssexam$religion <- NA
gssexam$religion[gssexam$relig == f$relig[which.max(f$freq)]] <- f$relig[which.max(f$freq)]
gssexam$religion[gssexam$relig != f$relig[which.max(f$freq)]] <- "Others"
"Protestant"
View(f)
gssexam$religion[gssexam$relig==NA]<-"Others"
#######################
# set working directory
# load data
# and load libraries
#######################
# remove objects
rm(list=ls())
# detach all libraries
detachAllPackages <- function() {
basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]
package.list <- setdiff(package.list,basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)
}
detachAllPackages()
# load libraries
pkgTest <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
lapply(c("stringr", "dplyr", "plyr", "tidyverse", "rvest", "zoo"), pkgTest)
##################
#b) Recode the variable *relig* to a new dichotomous variable *religion* with two categories:
#the one is the category with the most frequency named as itself,
#the other one is the rest of categories named "Others".
##################
gssexam <- read.csv("~/Desktop/gssexam.csv")
f <- gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
f$relig[which.max(f$freq)]
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[gssexam$relig != "Protestant"] <- "Others"
gssexam$religion[gssexam$relig==NA]<-"Others"
View(gssexam)
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[gssexam$relig==NA]<-"Others"
View(gssexam)
gssexam$religion[is.na(gssexam$relig)]<-"Others"
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[is.na(gssexam$religlion)]<-"Others"
gssexam$religion[is.na(gssexam$religlion)]
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
is.na(gssexam$religlion)
gssexam$religion[is.na(gssexam$religion)] <-"Others"
gssexam$religion[gssexam$religion==NA] <-"Others"
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[gssexam$religion==NA] <-"Others"
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[is.na(gssexam$religion)] <-"Others"
gssexam <- read.csv("~/Desktop/gssexam.csv")
f <- gssexam %>%
select(relig) %>%
group_by(relig) %>%
count()
f$relig[which.max(f$freq)]
gssexam$religion <- NA
gssexam$religion[gssexam$relig == "Protestant"] <- "Protestant"
gssexam$religion[is.na(gssexam$religion)] <-"Others"
View(gssexam)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
gssexam %>%
group_by(age) %>%
mutate(avgtv=mean(tvhours,na.rm=T)) %>%
ggplot(aes(x=age,y=avgtv))+
geom_point()+
labs(x="Age", y="Average Hours", title="Average hours of watch tv at each age by different races")+
facet_wrap(~race,ncol=2)
############################
# detach and load packages
############################
# remove objects
rm(list=ls())
# detach all libraries
detachAllPackages <- function() {
basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]
package.list <- setdiff(package.list,basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)
}
detachAllPackages()
# load libraries
pkgTest <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
lapply(c("stringr", "dplyr", "plyr", "tidyverse", "rvest", "zoo", "XML", "tidyr"), pkgTest)
##########################
# set working directory
# import dataset
# create raw dataset
##########################
# set working directory
setwd('~/Documents/GitHub/CompLegFall2019/data/uk_lower/raw_characteristics/')
# read in dataset
files <- list.files(pattern="*.xml", full.names=TRUE, recursive=FALSE)
# to dataframe
committees <- xmlToList(xmlParse(files[1]))
# constituencies <- xmlToDataFrame(files[2])
# experiences <- xmlToDataFrame(files[3])
# governmentPosts <- xmlToDataFrame(files[4])
# interests <- xmlToDataFrame(files[5])
# oppositionPosts <- xmlToDataFrame(files[6])
# parliamentaryPosts <- xmlToDataFrame(files[7])
# parties <- xmlToDataFrame(files[8])
# staff <- xmlToDataFrame(files[9])
##################################
# make the dataframe that we want
##################################
nullToNA <- function(x) {
if(is.null(x)){
x <- NA
} else {
x <- x
}
}
for (i in 1:length(committees)) {
ListAs <- committees[[i]]$ListAs
LayingMinisterName <- committees[[i]]$LayingMinisterName
House <- committees[[i]]$House
member_id <- committees[[i]][[".attrs"]]["Member_Id"]
ListAs <- nullToNA(ListAs)
LayingMinisterName <- nullToNA(LayingMinisterName)
House <- nullToNA(House)
member_id <- nullToNA(member_id)
for (j in 1:length(committees[[i]]$Committees)) {
committee_name <- committees[[i]]$Committees[[j]]$Name
start_date <- committees[[i]]$Committees[[j]]$StartDate
end_date <- committees[[i]]$Committees[[j]]$EndDate
chair_date <- committees[[i]]$Committees[[j]]$ChairDates
committee_id <- committees[[i]]$Committees[[j]][[".attrs"]]["Id"]
committee_name <- nullToNA(committee_name)
start_date <- nullToNA(start_date)
end_date <- nullToNA(end_date)
committee_id <- nullToNA(committee_id)
if (!is.null(chair_date)){
for (k in 1:length(chair_date <- committees[[i]]$Committees[[j]]$ChairDates)){
chair_startDate <- committees[[i]]$Committees[[j]]$ChairDates[[k]]$StartDate
chair_endDate <- committees[[i]]$Committees[[j]]$ChairDates[[k]]$EndDate
observation <- data.frame(full_name = ListAs,
House = House,
member_id = member_id,
committee_name = committee_name,
start_date = start_date,
end_date = end_date,
chair_startDate = chair_startDate,
chair_endDate = chair_endDate,
committee_id = committee_id)
out <- rbind(out, observation)
}
} else {
chair_startDate <- NA
chair_endDate <- NA
observation <- data.frame(full_name = ListAs,
House = House,
member_id = member_id,
committee_name = committee_name,
start_date = start_date,
end_date = end_date,
chair_startDate = chair_startDate,
chair_endDate = chair_endDate,
committee_id = committee_id)
if (i==1 && j==1) {
out <- observation
} else {
out <- rbind(out, observation)
}
}
}
}
#######################
# clean the dataframe
# create committee
#######################
df <- out
rownames(df) <- c()
df_a <- df %>%
select(committee_name, committee_id) %>%
mutate(committee_id = as.numeric(committee_id)) %>%
unique %>%
na.omit()
rownames(df_a) <- c()
View(df)
View(df)
df %>%
group_by(committee_name) %>%
mutate(n = sum(House == "Common"))
df_a <- df %>%
group_by(committee_name) %>%
mutate(n = sum(House == "Common"))
View(df_a)
df_a <- df %>%
group_by(committee_name) %>%
mutate(n = sum(House == "Commons"))
df_a <- df %>%
group_by(committee_name) %>%
group_by(House) %>%
mutate(n = sum(House == "Commons"))
View(df_a)
df_a <- df %>%
group_by(committee_name, House) %>%
count()
View(df_a)
df %>%
group_by(committee_name, House) %>%
count()
df_a <- df %>%
select(committee_name, committee_id, House) %>%
group_by(committee_name, House) %>%
count()
View(df_a)
df <- out
rownames(df) <- c()
df_a <- df %>%
select(committee_name, committee_id, House) %>%
group_by(committee_name, House) %>%
count()
df_b <- df %>%
select(committee_name, committee_id) %>%
mutate(committee_id = as.numeric(committee_id)) %>%
unique %>%
na.omit()
rownames(df_b) <- c()
